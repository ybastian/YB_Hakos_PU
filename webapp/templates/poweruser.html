{% extends "layout_no_sidebar.html" %}
{% block content %}
    <h1>Poweruser</h1>

{% if current_user.is_authenticated %}
<p>
    <span style="margin-right:50px;">
        Poweruser: {{current_user.firstname}} {{current_user.surname}}
    </span>
        Zum Übernehmen stehen {{orders|length}} Beobachtungsanträge an.
</p>
    <p><a class="btn btn-primary" href="{{ url_for('posts.new_post') }}">Ankündigung verfassen</a></p>


{% if orders|length > 0 %}

<div id="pu-message"></div>
<table class="table table-bordered table-striped table-hover">
    <thead>
        <tr>
            <th>Aktion</th>
            <th>Status</th>
            <th>Datum</th>
            <th>Beteiligte</th>
            <th>Observatorium</th>
            <th>Motivation</th>
            <th>Wunsch Poweruser</th>
            <th>Type</th>
            <th>Anmerkungen</th>
        </tr>
    </thead>
    <tbody>
    {% for order in orders %}
        <tr>
            <td>
  <a href="{{ url_for('orders.show_order_positions', order_id=order.id) }}"
     class="btn btn-sm btn-secondary" title="Details anzeigen">
    <i class="bi bi-eye"></i>
  </a>

<span id="pu-feedback-{{ order.id }}">
  {% if order.my_pu_meldung_availability %}
    <span class="text-success ms-2">In Datenbank gespeichert</span>
  {% endif %}
</span>

<input type="hidden" id="action-{{ order.id }}" name="action" value="pu_meldung">
<input type="hidden" id="order-{{ order.id }}" name="order_id" value="{{ order.id }}">

<select id="availability-{{ order.id }}" name="availability"
        class="form-select form-select-sm d-inline w-auto">
  <option value="1" {% if order.my_pu_meldung_availability == 1 %}selected{% endif %}>Möglich</option>
  <option value="2" {% if order.my_pu_meldung_availability == 2 %}selected{% endif %}>Vielleicht</option>
  <option value="3" {% if order.my_pu_meldung_availability == 3 %}selected{% endif %}>Nicht möglich</option>
</select>

<button type="button" class="btn btn-sm btn-outline-primary"
        hx-post="{{ url_for('main.poweruser') }}"
        hx-include="#action-{{ order.id }},#order-{{ order.id }},#availability-{{ order.id }}{% if csrf_token is defined %},#csrf_token{% endif %}"
        hx-target="#pu-feedback-{{ order.id }}"
        hx-swap="outerHTML">
  <i class="bi bi-save"></i>
</button>
</td>

            <td>{{ order.status_label }}</td>
            <td>{{ order.request_date.strftime('%d.%m.%Y') }}</td>
            <td>{{ order.name }}</td>
            <td>{{ order.observatory_name }}</td>
            <td>{{ order.request_purpose }}</td>
            <td>{{ order.poweruser_name if order.poweruser_name else '-' }}</td>
            <td>{{ order.request_type }}</td>
            <td>{{ order.remark }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% endif %}
<br>

{% endif %}

<a class="btn btn-warning" style="background-color: #007bff; color: white;"
   href="{{ url_for('main.home') }}">Zur Startseite</a>

{% endblock %}
